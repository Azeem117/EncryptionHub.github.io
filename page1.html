<!--
    Encryption Hub
    Copyright (C) 2025  MD AZEEM

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <https://www.gnu.org/licenses/>.
-->
<!--
Encryption Hub
Copyright (C) 2025  MD AZEEM

This software includes original code written by MD AZEEM and may include third-party libraries:

Third-party libraries used:
1. Tailwind CSS (https://tailwindcss.com/)
   - License: MIT
2. Google Fonts - Inter (https://fonts.google.com/specimen/Inter)
   - License: SIL Open Font License
3. CryptoJS (https://cdnjs.com/libraries/crypto-js)
   - License: MIT

This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program. If not, see <https://www.gnu.org/licenses/>.

---

Special Notes:
- Tailwind CSS and CryptoJS are used under their respective MIT licenses.
- Google Fonts are used under the SIL Open Font License.
- Redistribution of the software must comply with GPL-3.0 for original code and preserve notices for third-party libraries.
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encryption 1.0</title>
       <link rel="icon" type="image/png" sizes="32x32" href="logo/icon.png">
    <link rel="icon" type="image/png" sizes="48x48" href="logo/icon.png">
    <link rel="apple-touch-icon" sizes="180x180" href="logo/icon.png">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#15151F">

    <style>
        /* Import Inter font and a monospace font for results */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Fira+Code:wght@400;700&display=swap');

        /* Updated Global Styles for a Deep Cyber Theme */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #0A0A0E; /* Very dark background */
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 1rem;
            flex-direction: column;
            /* Subtle radial gradient for depth and atmosphere (Now with Blue accent) */
            background-image: radial-gradient(circle at 50% 50%, rgba(14, 165, 233, 0.05) 1px, transparent 1px),
                              radial-gradient(circle at 0% 100%, #15151F 5%, #0A0A0E 100%);
            background-size: 50px 50px, 100% 100%;
        }
        .container {
            width: 100%;
            max-width: 600px;
            /* Sharper, more defined container background */
            background-color: #15151F;
            padding: 2rem;
            border-radius: 1rem;
            /* Subtle border and a strong, but soft glow shadow (Now with Blue accent) */
            border: 1px solid #28283d;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.6),
                        0 0 40px rgba(14, 165, 233, 0.3); 
            animation: fadeIn 0.5s ease-in-out;
        }
        /* Neon Title Style */
        .neon-title {
            color: #0ea5e9; /* Neon Blue color */
            /* Text shadow creates the glow effect */
            text-shadow: 0 0 5px #0ea5e9, 0 0 10px #0ea5e9, 0 0 20px #0ea5e9, 0 0 40px rgba(14, 165, 233, 0.5);
            transition: text-shadow 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: #bae6fd; /* Light Cyan for better contrast */
            text-transform: uppercase;
            font-size: 0.85rem;
        }
        /* Input and Textarea Styling */
        .input, .textarea {
            width: 100%;
            padding: 0.75rem;
            border-radius: 0.5rem;
            background-color: #1f1f2e; /* Darker input background */
            border: 1px solid #3d3d52;
            color: #ffffff;
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        .input:focus, .textarea:focus {
            outline: none;
            border-color: #0ea5e9; /* Vibrant Blue focus border */
            /* Stronger, glowing focus shadow */
            box-shadow: 0 0 8px rgba(14, 165, 233, 0.8);
        }
        .textarea {
            resize: vertical;
            min-height: 150px;
        }
        .btn-group {
            display: flex;
            gap: 1rem;
            justify-content: space-between;
            flex-wrap: wrap;
        }
        .btn {
            flex-grow: 1;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, background-color 0.2s, box-shadow 0.2s;
            border: none;
        }
        /* Primary Button (Encrypt) - Vibrant, Glowing Accent (Neon Blue) */
        .btn-primary {
            background-color: #0ea5e9;
            color: #1f1f2e; /* Dark text for contrast on bright blue */
            box-shadow: 0 2px 8px rgba(14, 165, 233, 0.5);
        }
        .btn-primary:hover {
            background-color: #0284c7;
            transform: translateY(-2px);
            /* Stronger glow on hover */
            box-shadow: 0 0 18px rgba(14, 165, 233, 1.0), 0 4px 10px rgba(0, 0, 0, 0.5);
        }
        /* Secondary Buttons (Decrypt, Clear) - Darker, Discrete */
        .btn-secondary {
            background-color: #333345;
            color: #e0e0e0;
        }
        .btn-secondary:hover {
            background-color: #4f4f65;
            transform: translateY(-2px);
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }
        /* Result Box - Emphasize as an output data block */
        .result-box {
            background-color: #0d0d15;
            /* Dashed border for a "locked data" look */
            border: 1px dashed #4f4f65;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            max-height: 300px;
            overflow-y: auto;
        }
        .result-title {
            font-weight: 500;
            margin-bottom: 0.5rem;
            color: #bae6fd; /* Matching label color (Light Cyan) */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .result-text {
            /* Monospaced font for code/encrypted output */
            font-family: 'Fira Code', 'Consolas', monospace;
            color: #a7f3d0; /* Neon green/cyan for result text */
            word-break: break-all;
            font-size: 0.9rem;
            white-space: pre-wrap; /* Preserve line breaks if any */
        }
        /* Message Box - Thematic colors for feedback */
        .message-box {
            background-color: #2c2c2c;
            color: #ffffff;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1.5rem;
            text-align: center;
            animation: slideIn 0.3s ease-out;
            display: none;
        }
        /* Copy/Visibility Buttons */
        .copy-btn, .visibility-btn {
            background-color: transparent;
            border: 1px solid #3d3d52;
            color: #a0a0a0;
            padding: 0.5rem 0.75rem;
            border-radius: 0.5rem;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s, color 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .copy-btn:hover, .visibility-btn:hover {
            background-color: #28283d;
            color: #ffffff;
            transform: scale(1.05);
        }
        
        /* Utility Classes from original CSS */
        @keyframes slideIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .password-input-group {
            position: relative;
            display: flex;
            align-items: center;
        }
        .password-input-group .input {
            padding-right: 3rem;
        }
        .password-input-group .visibility-btn {
            position: absolute;
            right: 0.5rem;
            border: none;
            background-color: transparent;
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid #0ea5e9; /* Updated spinner color (Neon Blue) */
            border-radius: 50%;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin-left: 1rem;
            display: none;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .hidden {
            display: none;
        }
        /* Footer Styling */
        footer {
            margin-top: auto;
            padding-top: 2rem;
            text-align: center;
            color: #4f4f65; /* Subtler footer text */
        }
        footer p {
            margin: 0;
            padding: 0;
        }
        footer p a {
             color: #0ea5e9; /* Vibrant link color (Neon Blue) */
             transition: color 0.2s;
        }
        footer p a:hover {
            color: #7dd3fc; /* Lighter on hover */
        }

        /* Re-mapping original utility classes for consistency, though not strictly needed now */
        .bg-black { background-color: #0A0A0E; }
        .text-white { color: #fff; }
        .text-3xl { font-size: 1.875rem; }
        .font-bold { font-weight: 700; }
        .text-center { text-align: center; }
        .mb-8 { margin-bottom: 2rem; }
        .mt-6 { margin-top: 1.5rem; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .flex-grow { flex-grow: 1; }
        .h-5 { height: 1.25rem; }
        .w-5 { width: 1.25rem; }
    </style>
</head>
<body class="bg-black text-white">

<div class="container">
    <h1 class="text-3xl font-bold text-center mb-8"><span class="neon-title">Encryption 1.0</span> ðŸ’¾</h1>

    <div class="form-group">
        <label for="message" class="label">Input Message / Ciphertext</label>
        <textarea id="message" class="textarea" placeholder="Enter your secret data or encrypted cipher here..."></textarea>
    </div>

    <div class="form-group">
        <label for="password" class="label">Secret Key / Password</label>
        <div class="password-input-group">
            <input type="password" id="password" class="input flex-grow" placeholder="Enter a secure password for key derivation...">
            <button id="passwordToggle" class="visibility-btn" title="Toggle password visibility" aria-label="Toggle password visibility">
                <!-- Eye Icon (Visible) -->
                <svg id="eye-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                    <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                </svg>
                <!-- Eye Slash Icon (Hidden) -->
                <svg id="eye-slash-icon" xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 hidden" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M3.707 2.293A1 1 0 002.293 3.707l14 14a1 1 0 001.414-1.414l-14-14z" clip-rule="evenodd" />
                    <path d="M10 13a3 3 0 100-6 3 3 0 000 6z" />
                    <path fill-rule="evenodd" d="M13.673 17.51a.692.692 0 00-.776-.457A9.914 9.914 0 0110 18c-4.478 0-8.268-2.943-9.542-7-.052-.16-.079-.328-.083-.497a.692.692 0 00-.472-.515.692.692 0 00-.516.474c-.004.02-.007.039-.011.059.004.053.011.106.023.159C1.732 14.057 5.522 17 10 17c.502 0 .99-.036 1.464-.105a.692.692 0 00.709.619.692.692 0 00.618-.71zM10 4a6 6 0 00-6 6c0 1.259.324 2.44.887 3.518a.692.692 0 00.62.433.692.692 0 00.414-.153c.125-.1.2-.23.218-.372.584-2.887 3.23-5.06 6.37-5.06a.692.692 0 00.692-.692.692.692 0 00-.692-.692c-2.31 0-4.322 1.4-5.228 3.5a.692.692 0 00.088.583.692.692 0 00.583.088 6.002 6.002 0 00-2.844 2.845.692.692 0 00-.088.583.692.692 0 00.583.088c.126.04.253.078.38.115A5.998 5.000 0 0010 4z" clip-rule="evenodd" />
                </svg>
            </button>
        </div>
    </div>

    <div class="flex items-center justify-between">
        <div class="btn-group flex-grow">
            <button id="encryptBtn" class="btn btn-primary">Encrypt</button>
            <button id="decryptBtn" class="btn btn-secondary"> Decrypt</button>
            <button id="clearBtn" class="btn btn-secondary">Clear</button>
        </div>
        <div id="loadingSpinner" class="loading-spinner hidden"></div>
    </div>

    <div id="resultBox" class="result-box hidden mt-6">
        <div class="result-title">
            Output Console:
            <button id="copyBtn" class="copy-btn">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                    <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                    <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2 3 3 0 01-3 3h-2a3 3 0 01-3-3z" />
                </svg>
                Copy
            </button>
        </div>
        <div id="resultText" class="result-text"></div>
    </div>
    
    <div id="messageBox" class="message-box"></div>
</div>
    
<footer>
    <p>Encryption Hub v1.0.1 - <a href="https://www.gnu.org/licenses/gpl-3.0.html" class="text-blue-400 hover:underline">GPLv3 Licensed</a></p>
    <p class="text-gray-400">Copyright Â© 2025 Azeem117.</p>
</footer>    

<script>
    // --- Helper Functions ---

    // Converts a string to a Uint8Array.
    function strToUint8(str) {
        return new TextEncoder().encode(str);
    }

    // Converts a Uint8Array to a string.
    function uint8ToStr(uint8) {
        return new TextDecoder().decode(uint8);
    }

    // Converts an ArrayBuffer to a Base64 string.
    function arrayBufferToBase64(buffer) {
        let binary = '';
        const bytes = new Uint8Array(buffer);
        const len = bytes.byteLength;
        for (let i = 0; i < len; i++) {
            binary += String.fromCharCode(bytes[i]);
        }
        // Use btoa for Base64 encoding
        return window.btoa(binary);
    }

    // Converts a Base64 string to an ArrayBuffer.
    function base64ToArrayBuffer(base64) {
        const binaryString = window.atob(base64);
        const len = binaryString.length;
        const bytes = new Uint8Array(len);
        for (let i = 0; i < len; i++) {
            bytes[i] = binaryString.charCodeAt(i);
        }
        return bytes.buffer;
    }

    // Displays a temporary message to the user with updated thematic colors.
    function showMessage(text, isError = false) {
        const messageBox = document.getElementById('messageBox');
        messageBox.textContent = text;
        messageBox.style.display = 'block';
        if (isError) {
            // Error color: Soft Red
            messageBox.style.backgroundColor = '#f87171'; 
            messageBox.style.color = '#1f1f2e';
        } else {
            // Success/Info color: Neon Green
            messageBox.style.backgroundColor = '#34d399'; 
            messageBox.style.color = '#1f1f2e';
        }
        setTimeout(() => {
            messageBox.style.display = 'none';
        }, 3000);
    }

    // --- Core Cryptographic Functions (Unchanged as requested by user) ---

    // Derives a key from the user's password using PBKDF2 with a random salt.
    async function getKey(password, salt) {
        const keyMaterial = await window.crypto.subtle.importKey(
            "raw",
            strToUint8(password),
            { name: "PBKDF2" },
            false,
            ["deriveKey"]
        );
        return window.crypto.subtle.deriveKey(
            {
                name: "PBKDF2",
                salt: salt,
                iterations: 1000000,
                hash: "SHA-256",
            },
            keyMaterial,
            { name: "AES-GCM", length: 256 },
            true,
            ["encrypt", "decrypt"]
        );
    }

    // Encrypts a message (string or ArrayBuffer).
    async function encryptMessage(data, password) {
        try {
            if (!password) {
                showMessage("Please enter a password.", true);
                return;
            }

            // Generate a unique salt for this encryption.
            const salt = window.crypto.getRandomValues(new Uint8Array(16));
            const key = await getKey(password, salt);
            
            // Generate a unique IV (Initialization Vector) for this encryption.
            const iv = window.crypto.getRandomValues(new Uint8Array(12));

            const encryptedData = await window.crypto.subtle.encrypt(
                {
                    name: "AES-GCM",
                    iv: iv,
                },
                key,
                data
            );

            // Combine the salt, IV, and encrypted data.
            const combined = new Uint8Array(salt.byteLength + iv.byteLength + encryptedData.byteLength);
            combined.set(salt, 0);
            combined.set(iv, salt.byteLength);
            combined.set(new Uint8Array(encryptedData), salt.byteLength + iv.byteLength);

            return arrayBufferToBase64(combined);
        } catch (error) {
            console.error("Encryption failed:", error);
            showMessage("Encryption failed. Please try again.", true);
        }
    }

    // Decrypts an encrypted message (Base64 string).
    async function decryptMessage(encryptedMessage, password) {
        try {
            if (!encryptedMessage || !password) {
                showMessage("Please enter both the encrypted message and the password.", true);
                return;
            }
            
            const combined = base64ToArrayBuffer(encryptedMessage);
            if (combined.byteLength < 28) { // 16 bytes for salt + 12 for IV
                showMessage("Decryption failed. The message appears to be corrupted.", true);
                return;
            }

            // Separate the salt, IV, and encrypted data.
            const salt = combined.slice(0, 16);
            const iv = combined.slice(16, 28);
            const encryptedData = combined.slice(28);

            const key = await getKey(password, salt);

            // The 'decrypt' function automatically checks the authentication tag for data integrity.
            const decryptedData = await window.crypto.subtle.decrypt(
                {
                    name: "AES-GCM",
                    iv: iv,
                },
                key,
                encryptedData
            );

            return uint8ToStr(new Uint8Array(decryptedData));
        } catch (error) {
            console.error("Decryption failed:", error);
            // This is a generic catch-all, but usually indicates a bad password or corrupted data.
            showMessage("Decryption failed. Incorrect password or corrupted message.", true);
        }
    }

    // --- UI State Management Functions ---

    // Shows/hides the loading spinner and disables/enables buttons.
    function toggleLoading(isLoading) {
        const spinner = document.getElementById('loadingSpinner');
        const buttons = document.querySelectorAll('.btn-group .btn');
        if (isLoading) {
            spinner.classList.remove('hidden');
            buttons.forEach(btn => btn.disabled = true);
        } else {
            spinner.classList.add('hidden');
            buttons.forEach(btn => btn.disabled = false);
        }
    }

    // Clears all inputs and result area.
    function clearApp() {
        document.getElementById('message').value = '';
        document.getElementById('password').value = '';
        document.getElementById('resultBox').classList.add('hidden');
        document.getElementById('resultText').textContent = '';
        document.getElementById('messageBox').style.display = 'none'; // Hide message box on clear
        showMessage("Input cleared successfully.", false);
    }

    // --- Event Listeners ---

    // Handles the password visibility toggle.
    document.getElementById('passwordToggle').addEventListener('click', () => {
        const passwordInput = document.getElementById('password');
        const eyeIcon = document.getElementById('eye-icon');
        const eyeSlashIcon = document.getElementById('eye-slash-icon');
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            eyeIcon.classList.add('hidden');
            eyeSlashIcon.classList.remove('hidden');
        } else {
            passwordInput.type = 'password';
            eyeIcon.classList.remove('hidden');
            eyeSlashIcon.classList.add('hidden');
        }
    });

    // Handles the "Encrypt" button click.
    document.getElementById('encryptBtn').addEventListener('click', async () => {
        const messageInput = document.getElementById('message');
        if (!messageInput.value) {
            showMessage("Please enter a message to encrypt.", true);
            return;
        }
        
        toggleLoading(true);
        const passwordInput = document.getElementById('password');
        const resultBox = document.getElementById('resultBox');
        const resultText = document.getElementById('resultText');

        const encryptedData = await encryptMessage(strToUint8(messageInput.value), passwordInput.value);
        if (encryptedData) {
            resultText.textContent = encryptedData;
            resultBox.classList.remove('hidden');
            showMessage("Message encrypted successfully! Use the 'Copy' button.", false);
        } else {
             resultBox.classList.add('hidden');
        }
        toggleLoading(false);
    });

    // Handles the "Decrypt" button click.
    document.getElementById('decryptBtn').addEventListener('click', async () => {
        const messageInput = document.getElementById('message');
        if (!messageInput.value) {
            showMessage("Please enter a message to decrypt.", true);
            return;
        }

        toggleLoading(true);
        const passwordInput = document.getElementById('password');
        const resultBox = document.getElementById('resultBox');
        const resultText = document.getElementById('resultText');

        const decryptedData = await decryptMessage(messageInput.value, passwordInput.value);
        if (decryptedData) {
            resultText.textContent = decryptedData;
            resultBox.classList.remove('hidden');
            showMessage("Message decrypted successfully!", false);
        } else {
            resultBox.classList.add('hidden');
        }
        toggleLoading(false);
    });

    // Handles the "Clear" button click.
    document.getElementById('clearBtn').addEventListener('click', clearApp);

    // Copies the result to the clipboard.
    document.getElementById('copyBtn').addEventListener('click', () => {
        const textToCopy = document.getElementById('resultText').textContent;
        try {
            const tempInput = document.createElement('textarea');
            tempInput.value = textToCopy;
            document.body.appendChild(tempInput);
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            showMessage("Copied to clipboard!", false);
        } catch (err) {
            showMessage("Failed to copy. Please try again.", true);
        }
    });
</script>
</body>
</html>
